/*! typestate - v1.0.2 - 2016-06-23
* https://github.com/eonarheim/TypeState
* Copyright (c) 2016 Erik Onarheim; Licensed BSD-2-Clause*/
!function(a){if("object"==typeof module&&"object"==typeof module.exports){var b=a(require,exports);void 0!==b&&(module.exports=b)}else"function"==typeof define&&define.amd&&define(["require","exports"],a)}(function(a,b){"use strict";var c=function(){function a(a){this.fsm=a}return a.prototype.to=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];this.toStates=a,this.fsm.addTransitions(this)},a.prototype.toAny=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);this.toStates=b,this.fsm.addTransitions(this)},a}();b.Transitions=c;var d=function(){function a(a,b,c){this.fsm=a,this.from=b,this.to=c}return a}();b.TransitionFunction=d;var e=function(){function a(){}return a}();b.HierarchicalStateMachine=e;var f=function(){function a(a){this._transitionFunctions=[],this._onCallbacks={},this._exitCallbacks={},this._enterCallbacks={},this._invalidTransitionCallback=null,this.currentState=a,this._startState=a}return a.prototype.addTransitions=function(a){var b=this;a.fromStates.forEach(function(c){a.toStates.forEach(function(a){c===a||b._validTransition(c,a)||b._transitionFunctions.push(new d(b,c,a))})})},a.prototype.on=function(a,b){var c=a.toString();return this._onCallbacks[c]||(this._onCallbacks[c]=[]),this._onCallbacks[c].push(b),this},a.prototype.onEnter=function(a,b){var c=a.toString();return this._enterCallbacks[c]||(this._enterCallbacks[c]=[]),this._enterCallbacks[c].push(b),this},a.prototype.onExit=function(a,b){var c=a.toString();return this._exitCallbacks[c]||(this._exitCallbacks[c]=[]),this._exitCallbacks[c].push(b),this},a.prototype.onInvalidTransition=function(a){return this._invalidTransitionCallback||(this._invalidTransitionCallback=a),this},a.prototype.from=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var d=new c(this);return d.fromStates=a,d},a.prototype.fromAny=function(a){var b=[];for(var d in a)a.hasOwnProperty(d)&&b.push(a[d]);var e=new c(this);return e.fromStates=b,e},a.prototype._validTransition=function(a,b){return this._transitionFunctions.some(function(c){return c.from===a&&c.to===b})},a.prototype.canGo=function(a){return this.currentState===a||this._validTransition(this.currentState,a)},a.prototype.go=function(a){if(this.canGo(a))this._transitionTo(a);else if(!this._invalidTransitionCallback||!this._invalidTransitionCallback(this.currentState,a))throw new Error("Error no transition function exists from state "+this.currentState.toString()+" to "+a.toString())},a.prototype.onTransition=function(a,b){},a.prototype.reset=function(){this.currentState=this._startState},a.prototype.is=function(a){return this.currentState===a},a.prototype._transitionTo=function(a){var b=this;this._exitCallbacks[this.currentState.toString()]||(this._exitCallbacks[this.currentState.toString()]=[]),this._enterCallbacks[a.toString()]||(this._enterCallbacks[a.toString()]=[]),this._onCallbacks[a.toString()]||(this._onCallbacks[a.toString()]=[]);var c=this._exitCallbacks[this.currentState.toString()].reduce(function(c,d){return c&&d.call(b,a)},!0),d=this._enterCallbacks[a.toString()].reduce(function(a,c){return a&&c.call(b,b.currentState)},!0);if(c&&d){var e=this.currentState;this.currentState=a,this._onCallbacks[this.currentState.toString()].forEach(function(a){a.call(b,e)}),this.onTransition(e,a)}},a}();b.FiniteStateMachine=f});